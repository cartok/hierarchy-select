!function(a){"use strict";function b(a,b){a.offsetHeight+a.scrollTop<b.offsetTop+b.offsetHeight?a.scrollTop=b.offsetTop+b.offsetHeight-a.offsetHeight:a.scrollTop>b.offsetTop&&(a.scrollTop=b.offsetTop)}var c=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.hierarchySelect.defaults,c),this.$button=this.$element.children("button"),this.$selectedLabel=this.$button.children(".selected-label"),this.$menu=this.$element.children(".dropdown-menu"),this.$menuInner=this.$menu.children(".inner"),this.$searchbox=this.$menu.find("input"),this.$hiddenField=this.$element.children("input"),this.previouslySelected=null,this.init()};c.prototype={constructor:c,init:function(){this.setWidth(),this.setHeight(),this.initSelect(),this.clickListener(),this.buttonListener(),this.searchListener()},initSelect:function(){var a=this.$menuInner.find("li[data-default-selected]:first");if(a.length)this.setValue(a.data("value"));else{var b=this.$menuInner.find("li:first");this.setValue(b.data("value"))}},isItemSelected:function(){var b=this.$menuInner.find("li"),c=!1;return b.each(function(b,d){d=a(d),d.hasClass("active")&&!d.hasClass("hidden")&&(c=!0)}),c},setWidth:function(){if("auto"===this.options.width){var a=this.$menu.width();this.$element.css("min-width",a+2+"px")}else this.options.width?this.$element.css("width",this.options.width):this.$element.css("min-width","42px")},setHeight:function(){this.options.height&&(this.$menu.css("overflow","hidden"),this.$menuInner.css({"max-height":this.options.height,"overflow-y":"auto"}))},getText:function(){return this.$selectedLabel.text()},getValue:function(){return this.$hiddenField.val()},getFirstVisibleItem:function(){return this.$menuInner.find("li").not(".hidden").first()},setValue:function(a){var b=this.$menuInner.children('li[data-value="'+a+'"]:first');this.setSelected(b)},enable:function(){this.$button.removeAttr("disabled")},disable:function(){this.$button.attr("disabled","disabled")},setSelected:function(a){if(a.length){var b=a.children("a").text(),c=a.data("value");this.$selectedLabel.html(b),this.$hiddenField.val(c),this.$menuInner.find(".active").removeClass("active"),a.addClass("active"),this.$element.trigger("change")}},moveUp:function(){var a=this.$menuInner.find("li:not(.hidden,.disabled)"),c=this.$menuInner.find(".active"),d=a.index(c);void 0!==a[d-1]&&(this.$menuInner.find(".active").removeClass("active"),a[d-1].classList.add("active"),b(this.$menuInner[0],a[d-1]))},moveDown:function(){var a=this.$menuInner.find("li:not(.hidden,.disabled)"),c=this.$menuInner.find(".active"),d=a.index(c);void 0!==a[d+1]&&(this.$menuInner.find(".active").removeClass("active"),a[d+1]&&(a[d+1].classList.add("active"),b(this.$menuInner[0],a[d+1])))},selectItem:function(a){var b=this,c=void 0;if(a)c=a;else if(c=this.$menuInner.find(".active"),c.hasClass("hidden")||c.hasClass("disabled"))return;!0===b.options.returnAfterSelect||setTimeout(function(){b.$button.focus()},0),c&&this.setSelected(c),this.$button.dropdown("toggle")},clickListener:function(b){var c=this;this.$element.on("show.bs.dropdown",function(){var b=a(this);if(!0===c.options.togglePosition){var d=a(window).scrollTop(),e=a(window).height(),f=b.offset().top-d,g=b.outerHeight(),h=e-f-g,i=c.$menu.outerHeight(!0);h<i&&f>i&&b.toggleClass("dropup",!0)}var j=c.$menuInner.find(".active");j.length&&setTimeout(function(){var a=j[0],b=j[0].parentNode;b.scrollTop<=a.offsetTop&&b.scrollTop+b.clientHeight>a.offsetTop+a.clientHeight||(a.parentNode.scrollTop=a.offsetTop)},0)}),this.$element.on("shown.bs.dropdown",function(){c.previouslySelected=c.$menuInner.find(".active"),c.$searchbox.focus()}),this.$element.on("hidden.bs.dropdown",function(){c.$element.toggleClass("dropup",!1)}),this.$menuInner.on("click","li a",function(b){b.preventDefault();var d=a(this),e=d.parent();e.hasClass("disabled")?b.stopPropagation():c.setSelected(e)})},buttonListener:function(){var a=this;this.options.search||this.$button.on("keydown",function(b){switch(b.keyCode){case 9:a.$element.hasClass("open")&&b.preventDefault();break;case 13:a.$element.hasClass("open")&&(b.preventDefault(),a.selectItem());break;case 27:a.$element.hasClass("open")&&(b.preventDefault(),b.stopPropagation(),!1===a.options.returnAfterSelect&&a.$button.focus(),a.previouslySelected&&a.setSelected(a.previouslySelected),a.$button.dropdown("toggle"));break;case 38:a.$element.hasClass("open")&&(b.preventDefault(),b.stopPropagation(),a.moveUp());break;case 40:a.$element.hasClass("open")&&(b.preventDefault(),b.stopPropagation(),a.moveDown())}})},searchListener:function(){function b(a){for(var b=a,c=b.data("level");"object"==typeof b&&b.length>0&&c>1;)c--,b=b.prevAll('li[data-level="'+c+'"]:first'),b.hasClass("hidden")&&(b.toggleClass("disabled",!0),b.removeClass("hidden"))}var c=this;if(!this.options.search)return void this.$searchbox.parent().toggleClass("hidden",!0);this.$searchbox.on("keydown",function(a){switch(a.keyCode){case 9:a.preventDefault(),a.stopPropagation(),c.$menuInner.click(),c.$button.focus();break;case 13:if(c.isItemSelected())c.selectItem();else{var b=c.getFirstVisibleItem();c.setSelected(b),setTimeout(function(){c.selectItem(b)},120)}break;case 27:a.preventDefault(),a.stopPropagation(),c.options.keepFocused&&c.$button.focus(),c.$button.dropdown("toggle");break;case 38:a.preventDefault(),c.moveUp();break;case 40:a.preventDefault(),c.moveDown()}}),this.$searchbox.on("input propertychange",function(d){d.preventDefault();var e=c.$searchbox.val().toLowerCase(),f=c.$menuInner.find("li");0===e.length?f.each(function(){var b=a(this);b.toggleClass("disabled",!1),b.toggleClass("hidden",!1)}):f.each(function(){var d=a(this);-1!=d.children("a").text().toLowerCase().indexOf(e)?(d.toggleClass("disabled",!1),d.toggleClass("hidden",!1),c.options.hierarchy&&b(d)):(d.toggleClass("disabled",!1),d.toggleClass("hidden",!0))})})}};var d=function(b){var d,e=Array.prototype.slice.call(arguments,1),f=this.each(function(){var f=a(this),g=f.data("HierarchySelect"),h="object"==typeof b&&b;g||f.data("HierarchySelect",g=new c(this,h)),"string"==typeof b&&(d=g[b].apply(g,e))});return void 0===d?f:d},e=a.fn.hierarchySelect;a.fn.hierarchySelect=d,a.fn.hierarchySelect.defaults={width:"auto",height:"208px",hierarchy:!0,search:!0,togglePosition:!0,returnAfterSelect:!1,selectFirstOnEnter:!1,keepFocused:!0},a.fn.hierarchySelect.Constructor=c,a.fn.hierarchySelect.noConflict=function(){return a.fn.hierarchySelect=e,this}}(jQuery);